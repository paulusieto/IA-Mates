<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>IA Mates - Chat</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <div class="container">
    <div class="sidebar">
      <h2>IA Mates</h2>
      <ul>
        <li onclick="toggleMenu('EPAC')">EPAC
          <ul class="submenu" id="submenu-EPAC">
            <li onclick="navigate('EPAC', 'qcm')">QCM</li>
            <li onclick="navigate('EPAC', 'open')">OPEN</li>
          </ul>
        </li>
        <li onclick="toggleMenu('Pre-Exam')">Pre-Exam
          <ul class="submenu" id="submenu-Pre-Exam">
            <li onclick="navigate('Pre-Exam', 'qcm')">QCM</li>
            <li onclick="navigate('Pre-Exam', 'open')">OPEN</li>
          </ul>
        </li>
        <li onclick="toggleMenu('Paper D')">Paper D
          <ul class="submenu" id="submenu-Paper D">
            <li onclick="navigate('Paper D', 'qcm')">QCM</li>
            <li onclick="navigate('Paper D', 'open')">OPEN</li>
          </ul>
        </li>
      </ul>
    </div>
    <div class="main">
      <div class="chat-box" id="chat-box"></div>
      <div class="input-box">
        <textarea id="user-input" placeholder="Ask the AI a legal question..."></textarea>
        <button onclick="sendChat()">Send</button>
      </div>
    </div>
  </div>

<script>
function toggleMenu(id) {
  const el = document.getElementById('submenu-' + id);
  el.classList.toggle('open');
}
function navigate(source, qtype) {
  window.location.href = `/menu/${source}/${qtype}`;
}
function sendChat() {
  const input = document.getElementById('user-input').value;
  if (!input.trim()) return;
  const box = document.getElementById('chat-box');
  box.innerHTML += `<div class='bubble user'>${input}</div>`;
  document.getElementById('user-input').value = '';
  fetch('/api/open', {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({ chunk_id: '', user_answer: input })
  }).then(res => res.json()).then(data => {
    box.innerHTML += `<div class='bubble ai'>${data.explanation}</div>`;
    box.scrollTop = box.scrollHeight;
  });
}
</script>
</body>
</html>
